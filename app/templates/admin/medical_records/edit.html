{% extends "admin/base.html" %}

{% block title_key %}edit{% endblock %}
{% block title_ns %}medical_records{% endblock %}
{% block title %}診療記録修正{% endblock %}

{% block page_title %}<span data-i18n="edit" data-i18n-ns="medical_records">診療記録を編集</span>{% endblock %}
{% block page_description %}<span data-i18n="description" data-i18n-ns="medical_records">診療記録を修正</span>{% endblock %}

{% block header_actions %}
<a href="/admin/medical-records/{{ record_id }}" class="px-3 py-2 lg:px-4 lg:py-2 text-sm bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors" data-i18n="cancel" data-i18n-ns="common">
    キャンセル
</a>
{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <!-- ローディング表示 -->
    <div id="loadingIndicator" class="bg-white rounded-lg shadow-sm p-8 text-center">
        <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"></div>
        <p class="mt-2 text-gray-600" data-i18n="loading" data-i18n-ns="common">読み込み中...</p>
    </div>

    <!-- エラー表示 -->
    <div id="errorMessage" class="hidden bg-red-50 border border-red-200 rounded-lg p-4 mb-4">
        <p class="text-red-800"></p>
    </div>

    <!-- フォーム -->
    <div id="editForm" class="hidden bg-white rounded-lg shadow-sm p-4 lg:p-6">
        <form id="medicalRecordForm" class="space-y-6">
            <!-- 基本情報 -->
            <div class="border-b border-gray-200 pb-6">
                <h3 class="text-lg font-medium text-gray-900 mb-4">基本情報</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- 診療日 -->
                    <div>
                        <label for="date" class="block text-sm font-medium text-gray-700 mb-2">
                            診療日 <span class="text-red-500">*</span>
                        </label>
                        <input type="date" id="date" name="date" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                    </div>

                    <!-- 時間帯 -->
                    <div>
                        <label for="timeSlot" class="block text-sm font-medium text-gray-700 mb-2">
                            時間帯
                        </label>
                        <select id="timeSlot" name="time_slot" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                            <option value="">選択してください</option>
                            <option value="午前">午前</option>
                            <option value="午後">午後</option>
                            <option value="夕方">夕方</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- 測定値 -->
            <div class="border-b border-gray-200 pb-6">
                <h3 class="text-lg font-medium text-gray-900 mb-4">測定値</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- 体重 -->
                    <div>
                        <label for="weight" class="block text-sm font-medium text-gray-700 mb-2">
                            体重 (kg)
                        </label>
                        <input type="number" id="weight" name="weight" step="0.01" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                    </div>

                    <!-- 体温 -->
                    <div>
                        <label for="temperature" class="block text-sm font-medium text-gray-700 mb-2">
                            体温 (℃)
                        </label>
                        <input type="number" id="temperature" name="temperature" step="0.1" min="35" max="42" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                        <p class="mt-1 text-sm text-gray-500">正常範囲: 35.0〜42.0℃</p>
                    </div>
                </div>
            </div>

            <!-- 症状・所見 -->
            <div class="border-b border-gray-200 pb-6">
                <h3 class="text-lg font-medium text-gray-900 mb-4">症状・所見</h3>
                <div class="space-y-4">
                    <!-- 症状 -->
                    <div>
                        <label for="symptoms" class="block text-sm font-medium text-gray-700 mb-2">
                            症状 <span class="text-red-500">*</span>
                        </label>
                        <textarea id="symptoms" name="symptoms" rows="4" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"></textarea>
                    </div>

                    <!-- コメント -->
                    <div>
                        <label for="comment" class="block text-sm font-medium text-gray-700 mb-2">
                            コメント
                        </label>
                        <textarea id="comment" name="comment" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"></textarea>
                    </div>
                </div>
            </div>

            <!-- 処置（オプション） -->
            <div class="pb-6">
                <h3 class="text-lg font-medium text-gray-900 mb-4">処置（オプション）</h3>
                <div class="space-y-4">
                    <!-- 処置内容 -->
                    <div>
                        <label for="medicalActionId" class="block text-sm font-medium text-gray-700 mb-2">
                            処置内容
                        </label>
                        <select id="medicalActionId" name="medical_action_id" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                            <option value="">選択してください</option>
                        </select>
                    </div>

                    <!-- 投薬回数 -->
                    <div>
                        <label for="dosage" class="block text-sm font-medium text-gray-700 mb-2">
                            投薬回数
                        </label>
                        <input type="number" id="dosage" name="dosage" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                    </div>

                    <!-- その他処置 -->
                    <div>
                        <label for="other" class="block text-sm font-medium text-gray-700 mb-2">
                            その他処置
                        </label>
                        <textarea id="other" name="other" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"></textarea>
                    </div>
                </div>
            </div>

            <!-- ボタン -->
            <div class="flex flex-col sm:flex-row gap-3 pt-4">
                <button type="submit" class="flex-1 sm:flex-none px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-medium" data-i18n="update" data-i18n-ns="common">
                    更新する
                </button>
                <a href="/admin/medical-records/{{ record_id }}" class="flex-1 sm:flex-none px-6 py-3 text-center bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors font-medium" data-i18n="cancel" data-i18n-ns="common">
                    キャンセル
                </a>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="/static/js/admin/medical_record_edit.js"></script>
{% endblock %}
