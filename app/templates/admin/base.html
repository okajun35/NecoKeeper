<!DOCTYPE html>
<html lang="{{ settings.default_language }}">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Conditional Favicon: Kiroween Mode uses Halloween icon -->
    {% if settings.kiroween_mode %}
    <link rel="icon" type="image/webp" href="/static/icons/halloween_icon.webp">
    {% else %}
    <link rel="icon" type="image/svg+xml" href="/static/icons/default_icon.svg">
    {% endif %}

    <title data-i18n-title="{% block title_key %}title{% endblock %}" data-i18n-title-suffix=" - NecoKeeper"
        data-i18n-ns="{% block title_ns %}dashboard{% endblock %}">
        {% block title %}ÁÆ°ÁêÜÁîªÈù¢{% endblock %} - NecoKeeper
    </title>

    <!-- Tailwind CSS (Always load for layout utilities) -->
    <!-- Google Fonts (Outfit & Inter) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700&family=Inter:wght@400;500;600&display=swap"
        rel="stylesheet">

    <!-- Design System Theme -->
    <link rel="stylesheet" href="/static/css/theme.css?v={{ settings.static_version }}">

    <!-- Tailwind CSS (Always load for layout utilities) -->
    <script src="https://cdn.jsdelivr.net/npm/tailwindcss-cdn@3.4.1/tailwindcss.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            primary: 'rgba(var(--color-brand-primary-rgb), <alpha-value>)',
                            secondary: 'rgba(var(--color-brand-secondary-rgb), <alpha-value>)',
                            'primary-light': 'var(--color-brand-primary-light)',
                            'primary-dark': 'var(--color-brand-primary-dark)',
                        },
                        text: {
                            main: 'var(--color-text-main)',
                            muted: 'var(--color-text-muted)',
                        },
                        bg: {
                            base: 'var(--color-bg-base)',
                            surface: 'var(--color-bg-surface)',
                        }
                    },
                    fontFamily: {
                        sans: ['var(--font-body)'],
                        heading: ['var(--font-heading)'],
                        mono: ['var(--font-mono)'],
                    }
                }
            }
        }
    </script>

    <!-- Conditional CSS: Terminal CSS for Kiroween -->
    {% if settings.kiroween_mode %}
    <link rel="stylesheet" href="/static/css/terminal.css?v={{ range(1, 10000) | random }}">
    {% endif %}

    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@2.0.4"></script>

    <!-- Alpine.js for reactive components -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <!-- i18next for internationalization -->
    <script src="https://cdn.jsdelivr.net/npm/i18next@23.7.6/i18next.min.js"></script>

    <script>
        window.DEFAULT_LANGUAGE = "{{ settings.default_language }}";
        window.__ADMIN_BASE_PATH__ = "{{ settings.admin_base_path }}";
    </script>
    <!-- i18n module (with namespaces support) -->
    <script src="/static/js/i18n.js?v={{ settings.static_version }}"></script>

    {% block extra_head %}{% endblock %}

    <!-- Conditional Monospace Font Override for Kiroween Mode -->
    {% if settings.kiroween_mode %}
    <style>
        * {
            font-family: 'Courier New', Courier, monospace !important;
        }
    </style>
    {% endif %}

    <style>
        /* „Ç´„Çπ„Çø„É†„Çπ„Çø„Ç§„É´ */
        .i18n-hidden {
            display: none;
        }

        .sidebar-link {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            color: #374151;
            border-radius: 0.5rem;
            transition: all 0.2s;
        }

        .sidebar-link:hover {
            background-color: var(--color-brand-primary-light);
            color: var(--color-brand-primary-dark);
        }

        .sidebar-link.active {
            background-color: rgba(var(--color-brand-primary-rgb), 0.2);
            color: var(--color-brand-primary);
            font-weight: 500;
        }

        /* Dashboard card images - uniform size */
        #needs-care img {
            width: 120px;
            height: 120px;
            min-width: 120px;
            max-width: 120px;
            object-fit: cover;
        }

        @media (max-width: 640px) {
            #needs-care img {
                width: 80px;
                height: 80px;
                min-width: 80px;
                max-width: 80px;
            }
        }
    </style>

    {% block extra_styles %}{% endblock %}
</head>

<body class="bg-bg-base min-h-screen{% if settings.kiroween_mode %} kiroween-mode{% endif %} i18n-hidden"
    style="background-color: var(--color-bg-base);">
    <!-- CRT Overlay (Kiroween Mode only) -->
    {% if settings.kiroween_mode %}
    <div class="crt-overlay"></div>
    {% endif %}

    <div class="flex h-screen overflow-hidden">
        <!-- „Çµ„Ç§„Éâ„Éê„Éº -->
        {% include "admin/components/sidebar.html" %}

        <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ„Ç®„É™„Ç¢ -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <!-- „Éò„ÉÉ„ÉÄ„Éº -->
            <header class="bg-bg-surface border-b border-border px-4 lg:px-6 py-4"
                style="background-color: var(--color-bg-surface); border-color: var(--color-border);">
                <div class="grid items-center gap-4" style="grid-template-columns: minmax(0, 1fr) auto;">
                    <!-- „Éö„Éº„Ç∏„Çø„Ç§„Éà„É´ -->
                    <div class="min-w-0 ml-12 lg:ml-0">
                        <h2 class="text-xl lg:text-2xl font-bold text-gray-800 truncate tracking-normal font-mono">{%
                            block page_title %}{% endblock %}</h2>
                        <p class="text-xs lg:text-sm text-gray-500 mt-1 hidden sm:block font-mono">{% block
                            page_description %}{% endblock %}</p>
                    </div>

                    <!-- Âè≥ÂÅ¥„Ç®„É™„Ç¢ÔºàLife Monitor + „Ç¢„ÇØ„Ç∑„Éß„É≥Ôºâ -->
                    <div class="flex items-center gap-4">
                        <!-- Life Monitor (Kiroween Mode only) - Requirements: 16.1, 16.5 -->
                        {% if settings.kiroween_mode %}
                        <div id="life-monitor"></div>
                        {% endif %}

                        <!-- „Ç¢„ÇØ„Ç∑„Éß„É≥ -->
                        <div class="flex items-center gap-2 lg:gap-3">
                            {% block header_actions %}{% endblock %}

                            {% if not settings.kiroween_mode %}
                            <!-- Ë®ÄË™ûÂàá„ÇäÊõø„Åà -->
                            <button id="language-switcher"
                                class="flex items-center gap-2 px-3 py-2 text-gray-700 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129">
                                    </path>
                                </svg>
                                <span class="language-text hidden sm:inline">üáØüáµ Êó•Êú¨Ë™û</span>
                            </button>

                            <!-- ÈÄöÁü• -->
                            <button
                                class="relative p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors">
                                <svg class="w-5 h-5 lg:w-6 lg:h-6" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9">
                                    </path>
                                </svg>
                                <span class="absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full"></span>
                            </button>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </header>

            <!-- „Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
            <main class="flex-1 overflow-y-auto p-4 lg:p-6">
                {% block content %}{% endblock %}
            </main>
        </div>
    </div>

    <!-- „Éà„Éº„Çπ„Éà„É°„ÉÉ„Çª„Éº„Ç∏ -->
    <div id="toast-container" class="fixed bottom-4 right-4 z-50 space-y-2"></div>

    <!-- ÂÖ±ÈÄöJavaScript -->
    <script src="/static/js/admin/common.js?v=2"></script>
    <script src="/static/js/admin/mobile-menu.js"></script>

    <!-- Conditional JavaScript: Glitch effects for Kiroween Mode -->
    {% if settings.kiroween_mode %}
    <script src="/static/js/glitch-effects.js"></script>
    {% endif %}

    {% block extra_scripts %}{% endblock %}
</body>

</html>