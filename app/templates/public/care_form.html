{% extends "public/base.html" %}

{% block title_attributes %}data-i18n-title="title" data-i18n-ns="care" data-i18n-title-suffix=" - NecoKeeper"{%
endblock %}
{% block title %}世話記録入力 - NecoKeeper{% endblock %}

{% block extra_styles %}{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto p-4 pb-24">
    <!-- 言語切り替えボタン -->
    {% if not settings.kiroween_mode %}
    <div class="flex justify-end mb-4">
        <button id="language-switcher"
            class="flex items-center gap-2 px-3 py-2 text-text-muted hover:text-text-main hover:bg-bg-surface rounded-lg transition-colors shadow-sm bg-bg-surface"
            style="color: var(--color-text-muted); background-color: var(--color-bg-surface);">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129">
                </path>
            </svg>
            <span class="language-text">🇯🇵 日本語</span>
        </button>
    </div>
    {% endif %}

    <!-- ヘッダー: 猫情報 -->
    <div class="bg-bg-surface rounded-2xl shadow-card p-6 mb-6 border border-border"
        style="background-color: var(--color-bg-surface); border-radius: var(--radius-lg); box-shadow: var(--shadow-card); border-color: var(--color-border);">
        <div class="flex items-center gap-4">
            <img id="animalPhoto"
                src="{% if settings.kiroween_mode %}/static/icons/halloween_logo_2.webp{% else %}/static/images/default.svg{% endif %}"
                alt="猫の写真" class="w-24 h-24 rounded-full object-cover border-4 border-brand-primary shadow-soft"
                style="border-color: var(--color-brand-primary);">
            <div class="flex-1">
                <h1 id="animalName" class="text-2xl font-bold text-text-main mb-1 font-heading"
                    style="color: var(--color-text-main);"></h1>
                <p class="text-sm text-text-muted font-sans" data-i18n="instruction" data-i18n-ns="care"
                    style="color: var(--color-text-muted);">世話記録を入力してください</p>
            </div>
        </div>
    </div>

    <!-- 接続状態 -->
    <div id="connectionStatus" class="mb-4"></div>

    <!-- 同期状態 -->
    <div id="syncStatus" class="mb-4"></div>

    <!-- エラーメッセージ -->
    <div id="errorMessage"
        class="hidden bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-xl mb-4 shadow-sm" role="alert"
        aria-live="assertive"
        style="border-radius: var(--radius-md); color: var(--color-status-error); border-color: var(--color-status-error);">
        <div class="flex items-start gap-3">
            <div class="flex-1">
                <p class="font-medium" data-i18n="error_occurred" data-i18n-ns="care">エラーが発生しました</p>
                <p id="errorText" class="text-sm"></p>
            </div>
            <button type="button" class="text-sm text-red-700 hover:text-red-900" aria-label="Close"
                onclick="hideError()">&times;</button>
        </div>
    </div>

    <!-- 成功メッセージ -->
    <div id="successMessage"
        class="hidden bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-xl mb-4 shadow-sm"
        role="status" aria-live="polite"
        style="border-radius: var(--radius-md); color: var(--color-status-success); border-color: var(--color-status-success);">
        <p id="successText" class="font-medium" data-i18n="save_success" data-i18n-ns="care">✓ 記録を保存しました</p>
    </div>

    <!-- 入力フォーム -->
    <form id="careForm" class="space-y-6" novalidate
        data-image-receive-max-size-mb="{{ settings.care_log_image_receive_max_size_mb }}"
        data-image-save-max-size-mb="{{ settings.care_log_image_max_size_mb }}">
        <!-- 記録日 -->
        <div class="bg-bg-surface rounded-2xl shadow-card p-6 border border-border" data-field="logDate"
            style="background-color: var(--color-bg-surface); border-radius: var(--radius-lg); box-shadow: var(--shadow-card); border-color: var(--color-border);">
            <label for="logDate" class="block text-sm font-medium text-text-muted mb-3 font-sans"
                style="color: var(--color-text-muted);">
                <span data-i18n="log_date" data-i18n-ns="care">記録日</span> <span class="text-red-500"
                    data-i18n="required" data-i18n-ns="care">*</span>
            </label>
            <input type="date" id="logDate" name="log_date" required
                class="w-full px-4 py-3 border border-border rounded-xl focus:ring-2 focus:ring-brand-primary focus:border-transparent font-sans bg-bg-base"
                style="border-color: var(--color-border); border-radius: var(--radius-md); background-color: var(--color-bg-base);">
        </div>

        <!-- 時点選択 -->
        <div class="bg-bg-surface rounded-2xl shadow-card p-6 border border-border" data-field="timeSlot"
            style="background-color: var(--color-bg-surface); border-radius: var(--radius-lg); box-shadow: var(--shadow-card); border-color: var(--color-border);">
            <label class="block text-sm font-medium text-text-muted mb-3 font-sans"
                style="color: var(--color-text-muted);">
                <span data-i18n="time_slot" data-i18n-ns="care">時点</span> <span class="text-red-500"
                    data-i18n="required" data-i18n-ns="care">*</span>
            </label>
            <div class="grid grid-cols-3 gap-3">
                <button type="button"
                    class="time-slot-btn py-3 px-4 border-2 border-border rounded-xl text-center font-medium hover:border-brand-primary hover:bg-brand-primary/5 transition-all font-heading bg-bg-base"
                    style="border-radius: var(--radius-md); border-color: var(--color-border); background-color: var(--color-bg-base);"
                    data-value="morning" data-i18n="time_slot_morning" data-i18n-ns="care">
                    🌅 朝
                </button>
                <button type="button"
                    class="time-slot-btn py-3 px-4 border-2 border-border rounded-xl text-center font-medium hover:border-brand-primary hover:bg-brand-primary/5 transition-all font-heading bg-bg-base"
                    style="border-radius: var(--radius-md); border-color: var(--color-border); background-color: var(--color-bg-base);"
                    data-value="noon" data-i18n="time_slot_noon" data-i18n-ns="care">
                    ☀️ 昼
                </button>
                <button type="button"
                    class="time-slot-btn py-3 px-4 border-2 border-border rounded-xl text-center font-medium hover:border-brand-primary hover:bg-brand-primary/5 transition-all font-heading bg-bg-base"
                    style="border-radius: var(--radius-md); border-color: var(--color-border); background-color: var(--color-bg-base);"
                    data-value="evening" data-i18n="time_slot_evening" data-i18n-ns="care">
                    🌙 夜
                </button>
            </div>
            <input type="hidden" id="timeSlot" name="time_slot" required>
        </div>

        <!-- 食欲 -->
        <div class="bg-bg-surface rounded-2xl shadow-card p-6 border border-border" data-field="appetite"
            style="background-color: var(--color-bg-surface); border-radius: var(--radius-lg); box-shadow: var(--shadow-card); border-color: var(--color-border);">
            <label class="block text-sm font-medium text-text-muted mb-3 font-sans"
                style="color: var(--color-text-muted);">
                <span data-i18n="appetite" data-i18n-ns="care">食欲</span> <span class="text-red-500" data-i18n="required"
                    data-i18n-ns="care">*</span>
            </label>
            <div class="flex justify-between gap-2">
                <button type="button"
                    class="appetite-btn rating-button flex-1 py-3 px-2 border-2 border-border rounded-xl text-center font-medium hover:border-brand-primary hover:bg-brand-primary/5 transition-all text-xs font-heading bg-bg-base"
                    style="border-radius: var(--radius-md); border-color: var(--color-border); background-color: var(--color-bg-base);"
                    data-value="1" data-i18n="appetite_levels.3" data-i18n-ns="care">
                    ほぼ完食
                </button>
                <button type="button"
                    class="appetite-btn rating-button flex-1 py-3 px-2 border-2 border-border rounded-xl text-center font-medium hover:border-brand-primary hover:bg-brand-primary/5 transition-all text-xs font-heading bg-bg-base"
                    style="border-radius: var(--radius-md); border-color: var(--color-border); background-color: var(--color-bg-base);"
                    data-value="0.5" data-i18n="appetite_levels.2" data-i18n-ns="care">
                    半分くらい
                </button>
                <button type="button"
                    class="appetite-btn rating-button flex-1 py-3 px-2 border-2 border-border rounded-xl text-center font-medium hover:border-brand-primary hover:bg-brand-primary/5 transition-all text-xs font-heading bg-bg-base"
                    style="border-radius: var(--radius-md); border-color: var(--color-border); background-color: var(--color-bg-base);"
                    data-value="0" data-i18n="appetite_levels.1" data-i18n-ns="care">
                    ほぼ残す
                </button>
            </div>
            <input type="hidden" id="appetite" name="appetite" required>
        </div>

        <!-- 元気 -->
        <div class="bg-bg-surface rounded-2xl shadow-card p-6 border border-border" data-field="energy"
            style="background-color: var(--color-bg-surface); border-radius: var(--radius-lg); box-shadow: var(--shadow-card); border-color: var(--color-border);">
            <label class="block text-sm font-medium text-text-muted mb-3 font-sans"
                style="color: var(--color-text-muted);">
                <span data-i18n="energy" data-i18n-ns="care">元気</span> <span class="text-red-500" data-i18n="required"
                    data-i18n-ns="care">*</span>
            </label>
            <div class="flex justify-between gap-2">
                <button type="button"
                    class="energy-btn rating-button flex-1 py-3 px-2 border-2 border-border rounded-xl text-center font-medium hover:border-brand-primary hover:bg-brand-primary/5 transition-all bg-bg-base"
                    style="border-radius: var(--radius-md); border-color: var(--color-border); background-color: var(--color-bg-base);"
                    data-value="3" data-i18n="energy_levels.3" data-i18n-ns="care">
                    元気
                </button>
                <button type="button"
                    class="energy-btn rating-button flex-1 py-3 px-2 border-2 border-border rounded-xl text-center font-medium hover:border-brand-primary hover:bg-brand-primary/5 transition-all bg-bg-base"
                    style="border-radius: var(--radius-md); border-color: var(--color-border); background-color: var(--color-bg-base);"
                    data-value="2" data-i18n="energy_levels.2" data-i18n-ns="care">
                    低活力
                </button>
                <button type="button"
                    class="energy-btn rating-button flex-1 py-3 px-2 border-2 border-border rounded-xl text-center font-medium hover:border-brand-primary hover:bg-brand-primary/5 transition-all bg-bg-base"
                    style="border-radius: var(--radius-md); border-color: var(--color-border); background-color: var(--color-bg-base);"
                    data-value="1" data-i18n="energy_levels.1" data-i18n-ns="care">
                    ぐったり
                </button>
            </div>
            <input type="hidden" id="energy" name="energy" required>
        </div>

        <!-- 排尿・清掃 -->
        <div class="bg-bg-surface rounded-2xl shadow-card p-6 border border-border space-y-4"
            style="background-color: var(--color-bg-surface); border-radius: var(--radius-lg); box-shadow: var(--shadow-card); border-color: var(--color-border);">
            <!-- 嘔吐 -->
            <div data-field="vomiting">
                <label class="block text-sm font-medium text-text-muted mb-3 font-sans"
                    style="color: var(--color-text-muted);">
                    <span data-i18n="vomiting" data-i18n-ns="care">嘔吐</span>
                    <span class="text-red-500" data-i18n="required" data-i18n-ns="care">*</span>
                </label>
                <div class="flex gap-3">
                    <button type="button"
                        class="vomiting-btn flex-1 py-3 px-4 border-2 border-border rounded-xl text-center font-medium hover:border-brand-primary hover:bg-brand-primary/5 transition-colors bg-bg-base"
                        style="border-radius: var(--radius-md); border-color: var(--color-border); background-color: var(--color-bg-base);"
                        data-value="true" data-i18n="vomiting_yes" data-i18n-ns="care">
                        あり
                    </button>
                    <button type="button"
                        class="vomiting-btn flex-1 py-3 px-4 border-2 border-border rounded-xl text-center font-medium hover:border-brand-primary hover:bg-brand-primary/5 transition-colors bg-bg-base"
                        style="border-radius: var(--radius-md); border-color: var(--color-border); background-color: var(--color-bg-base);"
                        data-value="false" data-i18n="vomiting_no" data-i18n-ns="care">
                        なし
                    </button>
                </div>
                <input type="hidden" id="vomiting" name="vomiting">
            </div>

            <!-- 排尿 -->
            <div data-field="urination">
                <label class="block text-sm font-medium text-text-muted mb-3 font-sans"
                    style="color: var(--color-text-muted);">
                    <span data-i18n="urination" data-i18n-ns="care">排尿</span>
                    <span class="text-red-500" data-i18n="required" data-i18n-ns="care">*</span>
                </label>
                <div class="flex gap-3">
                    <button type="button"
                        class="urination-btn flex-1 py-3 px-4 border-2 border-border rounded-xl text-center font-medium hover:border-brand-primary hover:bg-brand-primary/5 transition-colors bg-bg-base"
                        style="border-radius: var(--radius-md); border-color: var(--color-border); background-color: var(--color-bg-base);"
                        data-value="true" data-i18n="urination_yes" data-i18n-ns="care">
                        あり
                    </button>
                    <button type="button"
                        class="urination-btn flex-1 py-3 px-4 border-2 border-border rounded-xl text-center font-medium hover:border-brand-primary hover:bg-brand-primary/5 transition-colors bg-bg-base"
                        style="border-radius: var(--radius-md); border-color: var(--color-border); background-color: var(--color-bg-base);"
                        data-value="false" data-i18n="urination_no" data-i18n-ns="care">
                        なし
                    </button>
                </div>
                <input type="hidden" id="urination" name="urination">
            </div>

            <!-- 排便 -->
            <div data-field="defecation">
                <label class="block text-sm font-medium text-text-muted mb-3 font-sans"
                    style="color: var(--color-text-muted);">
                    <span data-i18n="defecation" data-i18n-ns="care">排便</span>
                    <span class="text-red-500" data-i18n="required" data-i18n-ns="care">*</span>
                </label>
                <div class="flex gap-3">
                    <button type="button"
                        class="defecation-btn flex-1 py-3 px-4 border-2 border-border rounded-xl text-center font-medium hover:border-brand-primary hover:bg-brand-primary/5 transition-colors bg-bg-base"
                        style="border-radius: var(--radius-md); border-color: var(--color-border); background-color: var(--color-bg-base);"
                        data-value="true" data-i18n="defecation_yes" data-i18n-ns="care">
                        あり
                    </button>
                    <button type="button"
                        class="defecation-btn flex-1 py-3 px-4 border-2 border-border rounded-xl text-center font-medium hover:border-brand-primary hover:bg-brand-primary/5 transition-colors bg-bg-base"
                        style="border-radius: var(--radius-md); border-color: var(--color-border); background-color: var(--color-bg-base);"
                        data-value="false" data-i18n="defecation_no" data-i18n-ns="care">
                        なし
                    </button>
                </div>
                <input type="hidden" id="defecation" name="defecation">
            </div>

            <!-- 便の状態（排便ありの場合のみ） -->
            <div id="stoolConditionSection" class="hidden" data-field="stoolCondition">
                <div class="flex items-center justify-between mb-3">
                    <label class="block text-sm font-medium text-text-muted font-sans"
                        style="color: var(--color-text-muted);">
                        <span data-i18n="stool_condition" data-i18n-ns="care">便の状態</span>
                        <span class="text-red-500" data-i18n="required" data-i18n-ns="care">*</span>
                    </label>
                    <button type="button" id="stoolConditionHelpOpen"
                        class="text-sm text-brand-primary hover:text-brand-primary-dark"
                        style="color: var(--color-brand-primary);" data-i18n="stool_condition_help" data-i18n-ns="care">
                        ⓘ 判断に迷ったら
                    </button>
                </div>
                <div class="grid grid-cols-3 gap-3">
                    <button type="button"
                        class="stool-condition-btn py-3 px-3 border-2 border-border rounded-xl text-center font-medium hover:border-brand-primary hover:bg-brand-primary/5 transition-colors bg-bg-base"
                        style="border-radius: var(--radius-md); border-color: var(--color-border); background-color: var(--color-bg-base);"
                        data-value="1">
                        <img src="/static/images/cat_poops/cat_poop_1.png" alt="硬い" class="w-16 h-16 mx-auto">
                        <div class="mt-2 text-xs text-text-main" data-i18n="stool_condition_1" data-i18n-ns="care"
                            style="color: var(--color-text-main);">硬い</div>
                    </button>
                    <button type="button"
                        class="stool-condition-btn py-3 px-3 border-2 border-border rounded-xl text-center font-medium hover:border-brand-primary hover:bg-brand-primary/5 transition-colors bg-bg-base"
                        style="border-radius: var(--radius-md); border-color: var(--color-border); background-color: var(--color-bg-base);"
                        data-value="2">
                        <img src="/static/images/cat_poops/cat_poop_2.png" alt="良好" class="w-16 h-16 mx-auto">
                        <div class="mt-2 text-xs text-text-main" data-i18n="stool_condition_2" data-i18n-ns="care"
                            style="color: var(--color-text-main);">良好</div>
                    </button>
                    <button type="button"
                        class="stool-condition-btn py-3 px-3 border-2 border-border rounded-xl text-center font-medium hover:border-brand-primary hover:bg-brand-primary/5 transition-colors bg-bg-base"
                        style="border-radius: var(--radius-md); border-color: var(--color-border); background-color: var(--color-bg-base);"
                        data-value="3">
                        <img src="/static/images/cat_poops/cat_poop_3.png" alt="やや柔らかい" class="w-16 h-16 mx-auto">
                        <div class="mt-2 text-xs text-text-main" data-i18n="stool_condition_3" data-i18n-ns="care"
                            style="color: var(--color-text-main);">やや柔らかい</div>
                    </button>
                    <button type="button"
                        class="stool-condition-btn py-3 px-3 border-2 border-border rounded-xl text-center font-medium hover:border-brand-primary hover:bg-brand-primary/5 transition-colors bg-bg-base"
                        style="border-radius: var(--radius-md); border-color: var(--color-border); background-color: var(--color-bg-base);"
                        data-value="4">
                        <img src="/static/images/cat_poops/cat_poop_4.png" alt="下痢" class="w-16 h-16 mx-auto">
                        <div class="mt-2 text-xs text-text-main" data-i18n="stool_condition_4" data-i18n-ns="care"
                            style="color: var(--color-text-main);">下痢</div>
                    </button>
                    <button type="button"
                        class="stool-condition-btn py-3 px-3 border-2 border-border rounded-xl text-center font-medium hover:border-brand-primary hover:bg-brand-primary/5 transition-colors bg-bg-base"
                        style="border-radius: var(--radius-md); border-color: var(--color-border); background-color: var(--color-bg-base);"
                        data-value="5">
                        <img src="/static/images/cat_poops/cat_poop_5.png" alt="水様" class="w-16 h-16 mx-auto">
                        <div class="mt-2 text-xs text-text-main" data-i18n="stool_condition_5" data-i18n-ns="care"
                            style="color: var(--color-text-main);">水様</div>
                    </button>
                </div>
                <input type="hidden" id="stoolCondition" name="stool_condition">
            </div>

            <!-- 清掃 -->
            <div data-field="cleaning">
                <label class="block text-sm font-medium text-text-muted mb-3 font-sans"
                    style="color: var(--color-text-muted);">
                    <span data-i18n="cleaning" data-i18n-ns="care">清掃</span>
                    <span class="text-red-500" data-i18n="required" data-i18n-ns="care">*</span>
                </label>
                <div class="flex gap-3">
                    <button type="button"
                        class="cleaning-btn flex-1 py-3 px-4 border-2 border-border rounded-xl text-center font-medium hover:border-brand-primary hover:bg-brand-primary/5 transition-colors bg-bg-base"
                        style="border-radius: var(--radius-md); border-color: var(--color-border); background-color: var(--color-bg-base);"
                        data-value="true" data-i18n="cleaning_done" data-i18n-ns="care">
                        済
                    </button>
                    <button type="button"
                        class="cleaning-btn flex-1 py-3 px-4 border-2 border-border rounded-xl text-center font-medium hover:border-brand-primary hover:bg-brand-primary/5 transition-colors bg-bg-base"
                        style="border-radius: var(--radius-md); border-color: var(--color-border); background-color: var(--color-bg-base);"
                        data-value="false" data-i18n="cleaning_not_done" data-i18n-ns="care">
                        未
                    </button>
                </div>
                <input type="hidden" id="cleaning" name="cleaning">
            </div>
        </div>

        <!-- メモ -->
        <div class="bg-bg-surface rounded-2xl shadow-card p-6 border border-border" data-field="memo"
            style="background-color: var(--color-bg-surface); border-radius: var(--radius-lg); box-shadow: var(--shadow-card); border-color: var(--color-border);">
            <label for="memo" class="block text-sm font-medium text-text-muted mb-3 font-sans"
                style="color: var(--color-text-muted);">
                <span data-i18n="notes" data-i18n-ns="care">メモ</span>
            </label>
            <textarea id="memo" name="memo" rows="3"
                class="w-full px-4 py-3 border border-border rounded-xl focus:ring-2 focus:ring-brand-primary focus:border-transparent resize-none font-sans bg-bg-base"
                style="border-color: var(--color-border); border-radius: var(--radius-md); background-color: var(--color-bg-base);"
                data-i18n-placeholder="notes_placeholder" data-i18n-ns="care"
                placeholder="気になることがあれば記入してください"></textarea>
        </div>

        <!-- 写真登録 -->
        <div class="bg-bg-surface rounded-2xl shadow-card p-6 border border-border" data-field="careImage"
            style="background-color: var(--color-bg-surface); border-radius: var(--radius-lg); box-shadow: var(--shadow-card); border-color: var(--color-border);">
            <label for="careImage" class="block text-sm font-medium text-text-muted mb-3 font-sans"
                style="color: var(--color-text-muted);" data-i18n="care_image_optional" data-i18n-ns="care">
                写真登録
            </label>
            <input type="file" id="careImage" name="image" accept="image/jpeg,image/png,image/webp" capture="environment"
                class="sr-only"
                aria-describedby="careImageNote careImageSelectedFileName">
            <label for="careImage"
                class="inline-flex items-center gap-2 px-4 py-3 border-2 border-border rounded-xl font-medium cursor-pointer hover:border-brand-primary hover:bg-brand-primary/5 transition-colors bg-bg-base"
                style="border-color: var(--color-border); border-radius: var(--radius-md); background-color: var(--color-bg-base); color: var(--color-text-main);">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"
                    aria-hidden="true">
                    <path d="M3 7a2 2 0 0 1 2-2h2l1.2-1.5A2 2 0 0 1 9.8 3h4.4a2 2 0 0 1 1.6.8L17 5h2a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2Z" />
                    <circle cx="12" cy="12" r="3.5" />
                </svg>
                <span data-i18n="care_image_pick" data-i18n-ns="care">写真を追加</span>
            </label>
            <p id="careImageSelectedFileName" class="mt-2 text-xs text-text-muted hidden"
                style="color: var(--color-text-muted);"></p>
            <p id="careImageNote" class="mt-2 text-xs text-text-muted" style="color: var(--color-text-muted);">
                <span data-i18n="care_image_note_prefix" data-i18n-ns="care">最大</span>
                {{ settings.care_log_image_receive_max_size_mb }}MB
                <span data-i18n="care_image_note_receive_suffix" data-i18n-ns="care">まで受け付け、保存時に</span>
                {{ settings.care_log_image_max_size_mb }}MB
                <span data-i18n="care_image_note_suffix" data-i18n-ns="care">以下に圧縮します。送信後、public画面では画像は表示されません。</span>
            </p>

            <div id="careImagePreviewContainer" class="hidden mt-3">
                <img id="careImagePreview" src="" alt="preview"
                    class="w-full max-h-56 object-contain rounded-lg border border-border bg-bg-base"
                    style="border-color: var(--color-border);">
                <button id="careImageClearBtn" type="button"
                    class="mt-2 px-3 py-2 text-sm rounded-lg border border-border text-text-main hover:bg-black/5"
                    style="border-color: var(--color-border); color: var(--color-text-main);" data-i18n="care_image_clear"
                    data-i18n-ns="care">
                    画像を外す
                </button>
            </div>
        </div>

        <!-- ボランティア選択 -->
        <div class="bg-bg-surface rounded-2xl shadow-card p-6 border border-border" data-field="volunteer"
            style="background-color: var(--color-bg-surface); border-radius: var(--radius-lg); box-shadow: var(--shadow-card); border-color: var(--color-border);">
            <label for="volunteer" class="block text-sm font-medium text-text-muted mb-3 font-sans"
                style="color: var(--color-text-muted);">
                <span data-i18n="recorder" data-i18n-ns="care">記録者</span> <span class="text-red-500"
                    data-i18n="required" data-i18n-ns="care">*</span>
            </label>
            <select id="volunteer" name="recorder_id" required
                class="w-full px-4 py-3 border border-border rounded-xl focus:ring-2 focus:ring-brand-primary focus:border-transparent font-sans bg-bg-base"
                style="border-color: var(--color-border); border-radius: var(--radius-md); background-color: var(--color-bg-base);">
                <option value="" data-i18n="please_select" data-i18n-ns="common">選択してください</option>
            </select>
        </div>
    </form>
</div>

<!-- 保存完了トースト -->
<div id="successToast" class="hidden fixed left-1/2 transform -translate-x-1/2 bottom-28 w-[90%] max-w-md z-50">
    <div class="bg-brand-primary text-white px-4 py-3 rounded-xl shadow-lg flex items-start gap-3"
        style="background-color: var(--color-brand-primary);">
        <span class="text-lg">✓</span>
        <div class="flex-1">
            <p id="successToastText" class="font-medium text-sm" data-i18n="save_success" data-i18n-ns="care">記録を保存しました
            </p>
            <p id="successToastSubText" class="text-xs text-white/80"></p>
        </div>
        <button type="button" class="text-sm font-semibold" aria-label="Close" onclick="hideToast()">×</button>
    </div>
</div>

<!-- 固定フッター: 保存ボタン -->
<div class="fixed bottom-0 left-0 right-0 {% if settings.kiroween_mode %}border-green-500{% else %}bg-bg-surface border-border{% endif %} border-t p-4 shadow-lg-reverse"
    style="background-color: {% if settings.kiroween_mode %}#000000{% else %}var(--color-bg-surface){% endif %} !important; border-top-color: {% if settings.kiroween_mode %}#1a8000{% else %}var(--color-border){% endif %};">
    <div class="max-w-2xl mx-auto space-y-2">
        <div class="flex gap-3">
            <button type="button" id="copyLastBtn"
                class="flex-1 py-3 px-6 {% if settings.kiroween_mode %}bg-black text-green-500 border border-green-500 hover:bg-gray-900{% else %}bg-bg-base text-text-main hover:bg-black/5{% endif %} rounded-xl font-medium transition-colors border border-border"
                style="{% if not settings.kiroween_mode %}background-color: var(--color-bg-base); color: var(--color-text-main); border-color: var(--color-border); border-radius: var(--radius-md);{% endif %}"
                data-i18n="copy_last" data-i18n-ns="care">
                前回値コピー
            </button>
            <button type="submit" form="careForm" id="submitBtn"
                class="flex-1 py-3 px-6 {% if settings.kiroween_mode %}bg-black text-[#33ff00] border border-[#33ff00] hover:bg-[#0d4000]{% else %}bg-brand-primary text-white hover:bg-opacity-90{% endif %} rounded-xl font-medium transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed shadow-md"
                style="{% if not settings.kiroween_mode %}background-color: var(--color-brand-primary); border-radius: var(--radius-md);{% endif %}"
                data-i18n="save" data-i18n-ns="care">
                保存
            </button>
        </div>
        <a id="viewLogsBtn" href="#"
            class="block w-full py-2 px-4 {% if settings.kiroween_mode %}bg-black text-green-500 border-green-500 hover:bg-gray-900{% else %}bg-bg-surface text-brand-primary border-brand-primary hover:bg-brand-primary/5{% endif %} text-center rounded-xl font-medium border-2 transition-colors text-sm"
            style="{% if not settings.kiroween_mode %}background-color: transparent; color: var(--color-brand-primary); border-color: var(--color-brand-primary); border-radius: var(--radius-md);{% endif %}"
            data-i18n="view_logs" data-i18n-ns="care">
            記録一覧を見る
        </a>
    </div>
</div>

<!-- 便の状態の目安モーダル -->
<div id="stoolConditionHelpModal" class="hidden fixed inset-0 z-50" role="dialog" aria-modal="true">
    <div class="absolute inset-0 bg-black/40" id="stoolConditionHelpBackdrop"></div>
    <div class="absolute inset-x-0 bottom-0 sm:inset-0 sm:flex sm:items-center sm:justify-center p-4">
        <div class="bg-bg-surface rounded-2xl shadow-xl w-full max-w-lg p-6"
            style="background-color: var(--color-bg-surface); border-radius: var(--radius-lg);">
            <div class="flex items-start justify-between gap-4">
                <h2 class="text-lg font-bold text-text-main font-heading" data-i18n="stool_condition_help_title"
                    data-i18n-ns="care" style="color: var(--color-text-main);">排泄の状態の目安</h2>
                <button type="button" id="stoolConditionHelpClose" class="text-text-muted hover:text-text-main"
                    aria-label="Close" style="color: var(--color-text-muted);">×</button>
            </div>
            <p class="mt-3 text-sm text-text-secondary" data-i18n="stool_condition_help_intro" data-i18n-ns="care"
                style="color: var(--color-text-muted);">
                写真ではありません。いちばん近い状態を選んでください。迷った場合は「良好」で問題ありません。
            </p>

            <div class="mt-4 space-y-4 text-sm text-text-main" style="color: var(--color-text-main);">
                <div class="flex gap-3">
                    <img src="/static/images/cat_poops/cat_poop_1.png" alt="" class="w-10 h-10 flex-none">
                    <div>
                        <div class="font-medium" data-i18n="stool_condition_1" data-i18n-ns="care">硬い</div>
                        <div class="text-text-muted" data-i18n="stool_condition_desc_1" data-i18n-ns="care"
                            style="color: var(--color-text-muted);">水分が少なく、乾いた見た目。小さく分かれていることがあります。</div>
                    </div>
                </div>
                <div class="flex gap-3">
                    <img src="/static/images/cat_poops/cat_poop_2.png" alt="" class="w-10 h-10 flex-none">
                    <div>
                        <div class="font-medium" data-i18n="stool_condition_2" data-i18n-ns="care">良好</div>
                        <div class="text-text-muted" data-i18n="stool_condition_desc_2" data-i18n-ns="care"
                            style="color: var(--color-text-muted);">形があり、適度なやわらかさ。日常的にはこの状態が目安です。</div>
                    </div>
                </div>
                <div class="flex gap-3">
                    <img src="/static/images/cat_poops/cat_poop_3.png" alt="" class="w-10 h-10 flex-none">
                    <div>
                        <div class="font-medium" data-i18n="stool_condition_3" data-i18n-ns="care">やや柔らかい</div>
                        <div class="text-text-muted" data-i18n="stool_condition_desc_3" data-i18n-ns="care"
                            style="color: var(--color-text-muted);">形はあるが少しつぶれやすい。一時的な変化として見られることもあります。</div>
                    </div>
                </div>
                <div class="flex gap-3">
                    <img src="/static/images/cat_poops/cat_poop_4.png" alt="" class="w-10 h-10 flex-none">
                    <div>
                        <div class="font-medium" data-i18n="stool_condition_4" data-i18n-ns="care">下痢</div>
                        <div class="text-text-muted" data-i18n="stool_condition_desc_4" data-i18n-ns="care"
                            style="color: var(--color-text-muted);">形がほとんど保てない。まとまりがなく柔らかい状態です。</div>
                    </div>
                </div>
                <div class="flex gap-3">
                    <img src="/static/images/cat_poops/cat_poop_5.png" alt="" class="w-10 h-10 flex-none">
                    <div>
                        <div class="font-medium" data-i18n="stool_condition_5" data-i18n-ns="care">水様</div>
                        <div class="text-text-muted" data-i18n="stool_condition_desc_5" data-i18n-ns="care"
                            style="color: var(--color-text-muted);">ほぼ液体に近い。広がりやすく形がない状態です。</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="/static/js/care_form.js"></script>
{% endblock %}
