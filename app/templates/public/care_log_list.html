{% extends "public/base.html" %}

{% block title_attributes %}data-i18n-title="public.page_title" data-i18n-ns="care_logs" data-i18n-title-suffix=" -
NecoKeeper"{% endblock %}
{% block title %}è¨˜éŒ²ä¸€è¦§ - NecoKeeper{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto p-4 pb-24">
    {% if not settings.kiroween_mode %}
    <div class="flex justify-end mb-4">
        <button id="language-switcher"
            class="flex items-center gap-2 px-3 py-2 text-gray-700 hover:text-gray-900 hover:bg-white rounded-lg transition-colors shadow-sm bg-white">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129">
                </path>
            </svg>
            <span class="language-text">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</span>
        </button>
    </div>
    {% endif %}

    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼: çŒ«æƒ…å ± -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-6">
        <div class="flex items-center gap-4">
            <img id="animalPhoto" src="" alt="" data-i18n-alt="public.animal_photo_alt" data-i18n-ns="care_logs"
                class="w-24 h-24 rounded-full object-cover border-4 border-brand-primary"
                style="border-color: var(--color-brand-primary);">
            <div class="flex-1">
                <h1 id="animalName" class="text-2xl font-bold text-gray-800 mb-1"></h1>
                <p id="animalHeaderCaption" class="text-sm text-gray-500"></p>
            </div>
        </div>
    </div>

    <!-- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
    <div id="errorMessage" class="hidden bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-4"
        role="alert" aria-live="assertive">
        <p class="font-medium" data-i18n="public.error_heading" data-i18n-ns="care_logs">ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</p>
        <p id="errorText" class="text-sm"></p>
    </div>

    <!-- æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
    <div id="successMessage" class="hidden bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg mb-4"
        role="status" aria-live="polite">
        <p id="successText" class="font-medium" data-i18n="public.success_heading" data-i18n-ns="care_logs">âœ“ è¨˜éŒ²ã‚’ä¿å­˜ã—ã¾ã—ãŸ
        </p>
    </div>

    <!-- ä»Šæ—¥ã®è¨˜éŒ²çŠ¶æ³ -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-6">
        <h2 class="text-lg font-bold text-gray-800 mb-4" data-i18n="public.today_status_title" data-i18n-ns="care_logs">
            ä»Šæ—¥ã®è¨˜éŒ²çŠ¶æ³</h2>
        <div class="grid grid-cols-3 gap-3">
            <div id="morningStatus" class="text-center p-4 rounded-lg border-2">
                <div class="text-2xl mb-1">{% if settings.kiroween_mode %}ğŸ¦‡{% else %}ğŸŒ…{% endif %}</div>
                <div class="text-sm font-medium text-gray-700" data-i18n="public.time_slots.morning"
                    data-i18n-ns="care_logs">æœ</div>
                <div class="text-lg font-bold mt-1" id="morningIcon">-</div>
            </div>
            <div id="noonStatus" class="text-center p-4 rounded-lg border-2">
                <div class="text-2xl mb-1">{% if settings.kiroween_mode %}ğŸƒ{% else %}â˜€ï¸{% endif %}</div>
                <div class="text-sm font-medium text-gray-700" data-i18n="public.time_slots.noon"
                    data-i18n-ns="care_logs">æ˜¼</div>
                <div class="text-lg font-bold mt-1" id="noonIcon">-</div>
            </div>
            <div id="eveningStatus" class="text-center p-4 rounded-lg border-2">
                <div class="text-2xl mb-1">{% if settings.kiroween_mode %}ğŸ‘»{% else %}ğŸŒ™{% endif %}</div>
                <div class="text-sm font-medium text-gray-700" data-i18n="public.time_slots.evening"
                    data-i18n-ns="care_logs">å¤œ</div>
                <div class="text-lg font-bold mt-1" id="eveningIcon">-</div>
            </div>
        </div>
    </div>

    <!-- éå»7æ—¥ã®æ—¥åˆ¥ãƒ“ãƒ¥ãƒ¼ -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-6" id="dailyOverviewSection">
        <div class="flex flex-col gap-2 sm:flex-row sm:items-start sm:justify-between">
            <div>
                <h2 class="text-lg font-bold text-gray-800" data-i18n="public.daily_overview_title"
                    data-i18n-ns="care_logs">éå»7æ—¥ã®æ—¥åˆ¥çŠ¶æ³</h2>
                <p class="text-sm text-gray-500" data-i18n="public.daily_overview_description" data-i18n-ns="care_logs">
                    æœãƒ»æ˜¼ãƒ»å¤œã®è¨˜éŒ²æœ‰ç„¡ã‚’æ—¥ã”ã¨ã«ç¢ºèªã§ãã¾ã™</p>
            </div>
            <p class="text-xs text-gray-400" data-i18n="public.daily_overview_hint" data-i18n-ns="care_logs">
                æ¬ ã‘ã¦ã„ã‚‹æ—¥ãŒãªã„ã‹ç¢ºèªã—ã¾ã—ã‚‡ã†</p>
        </div>

        <div class="lg:hidden mt-4 space-y-3" id="dailyStatusCards"></div>

        <div class="hidden lg:block mt-4 overflow-x-auto">
            <table class="w-full text-sm">
                <thead class="bg-gray-50 text-gray-500 uppercase text-xs tracking-wider">
                    <tr>
                        <th class="px-4 py-3 text-left" data-i18n="public.daily_table.date" data-i18n-ns="care_logs">æ—¥ä»˜
                        </th>
                        <th class="px-4 py-3 text-center" data-i18n="public.time_slots.morning"
                            data-i18n-ns="care_logs">æœ</th>
                        <th class="px-4 py-3 text-center" data-i18n="public.time_slots.noon" data-i18n-ns="care_logs">æ˜¼
                        </th>
                        <th class="px-4 py-3 text-center" data-i18n="public.time_slots.evening"
                            data-i18n-ns="care_logs">å¤œ</th>
                    </tr>
                </thead>
                <tbody id="dailyStatusTableBody" class="divide-y divide-gray-200"></tbody>
            </table>
        </div>
    </div>

    <!-- æœ€æ–°ã®è¨˜éŒ²ä¸€è¦§ -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-6">
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 mb-4">
            <h2 class="text-lg font-bold text-gray-800" data-i18n="public.latest_logs_title" data-i18n-ns="care_logs">
                æœ€æ–°ã®è¨˜éŒ²</h2>
            <p class="text-sm text-gray-500" data-i18n="public.latest_logs_description" data-i18n-ns="care_logs">
                æœ€æ–°ã®å…¥åŠ›é †ã§è¡¨ç¤ºã—ã¦ã„ã¾ã™</p>
        </div>
        <div id="recentLogs" class="space-y-3">
            <!-- JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
        </div>
        <div id="noLogs" class="hidden text-center py-8 text-gray-500">
            <p class="text-lg mb-2">ğŸ“</p>
            <p data-i18n="public.no_logs_message" data-i18n-ns="care_logs">ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</p>
            <p class="text-sm mt-2" data-i18n="public.no_logs_hint" data-i18n-ns="care_logs">ç›´è¿‘ã®è¨˜éŒ²ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</p>
        </div>
    </div>
</div>

<!-- å›ºå®šãƒ•ãƒƒã‚¿ãƒ¼: è¨˜éŒ²å…¥åŠ›ãƒœã‚¿ãƒ³ -->
<!-- Templates for JS Rendering -->
<template id="tmpl-daily-card">
    <div class="border border-gray-200 rounded-xl p-4 shadow-sm bg-white">
        <div class="flex items-center justify-between gap-2 mb-3">
            <div class="flex items-center gap-2">
                <div class="text-base font-semibold text-gray-800 js-date"></div>
                <span
                    class="hidden inline-flex items-center rounded-full bg-brand-primary-light px-2 py-0.5 text-xs font-medium text-brand-primary-dark js-badge"></span>
            </div>
        </div>
        <div class="grid grid-cols-3 gap-2 js-slots"></div>
    </div>
</template>

<template id="tmpl-slot-chip">
    <button type="button"
        class="flex flex-col items-center rounded-xl border px-3 py-2 text-center transition-colors w-full js-chip-container hover:opacity-90">
        <div class="text-2xl js-emoji"></div>
        <div class="mt-1 text-xs font-medium js-label"></div>
        <div class="mt-1 text-sm font-semibold js-status"></div>
        <div class="text-xs mt-1 truncate w-full opacity-80 js-recorder hidden"></div>
    </button>
</template>

<template id="tmpl-log-item">
    <div
        class="flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-brand-primary/5 transition-colors cursor-pointer bg-white mb-2 js-log-container">
        <div class="flex items-center gap-3">
            <div class="text-2xl js-emoji"></div>
            <div>
                <div class="font-medium text-gray-800 js-date"></div>
                <div class="text-sm text-gray-500 js-meta"></div>
            </div>
        </div>
        <div class="font-bold text-brand-secondary js-check">â—‹</div>
    </div>
</template>

<template id="tmpl-log-detail-modal">
    <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 js-modal-overlay">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full p-6 js-modal-content">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-gray-800 js-modal-title"></h3>
                <button type="button" class="text-gray-500 hover:text-gray-700 js-close-btn" aria-label="Close">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
                        </path>
                    </svg>
                </button>
            </div>
            <div class="space-y-3 js-details-container">
                <!-- Detail rows will be injected here -->
            </div>
            <div class="pt-4 js-memo-wrapper hidden">
                <div class="text-gray-600 mb-1 js-memo-label"></div>
                <div class="text-sm text-gray-800 bg-gray-50 p-3 rounded js-memo-content whitespace-pre-wrap"></div>
            </div>
            <div class="mt-6 space-y-3">
                <a href="#"
                    class="w-full inline-flex justify-center py-3 bg-brand-primary text-white rounded-lg font-medium hover:opacity-90 transition-colors js-edit-btn"></a>
                <button type="button"
                    class="w-full py-3 bg-gray-100 text-gray-700 rounded-lg font-medium hover:bg-gray-200 transition-colors js-footer-close-btn"></button>
            </div>
        </div>
    </div>
</template>

<template id="tmpl-detail-row">
    <div class="flex justify-between py-2 border-b">
        <span class="text-gray-600 js-label"></span>
        <span class="font-medium js-value"></span>
    </div>
</template>

<!-- å›ºå®šãƒ•ãƒƒã‚¿ãƒ¼: è¨˜éŒ²å…¥åŠ›ãƒœã‚¿ãƒ³ -->
<div class="fixed bottom-0 left-0 right-0 {% if settings.kiroween_mode %}border-green-500{% else %}bg-white border-gray-200{% endif %} border-t p-4 shadow-lg"
    style="{% if not settings.kiroween_mode %}background-color: var(--color-bg-base); border-top-color: var(--color-border);{% endif %} {% if settings.kiroween_mode %}background-color: #000000 !important;{% endif %}">
    <div class="max-w-2xl mx-auto space-y-2">
        <a id="addRecordBtn" href="#"
            class="block w-full py-3 px-6 {% if settings.kiroween_mode %}bg-black text-[#33ff00] border border-[#33ff00] hover:bg-[#0d4000]{% else %}bg-brand-primary text-white hover:opacity-90{% endif %} text-center rounded-lg font-medium transition-colors"
            style="{% if not settings.kiroween_mode %}background-color: var(--color-brand-primary); border-radius: var(--radius-md);{% endif %}"
            data-i18n="public.add_record" data-i18n-ns="care_logs">
            è¨˜éŒ²ã‚’å…¥åŠ›ã™ã‚‹
        </a>
        <a href="/public/animals/status"
            class="block w-full py-2 px-4 {% if settings.kiroween_mode %}bg-black text-green-500 border-green-500 hover:bg-gray-900{% else %}bg-bg-surface text-brand-primary border-brand-primary hover:bg-brand-primary/5{% endif %} text-center rounded-lg font-medium border-2 transition-colors text-sm"
            style="{% if not settings.kiroween_mode %}background-color: var(--color-bg-surface); color: var(--color-brand-primary); border-color: var(--color-brand-primary); border-radius: var(--radius-md);{% endif %}"
            data-i18n="public.view_all_status" data-i18n-ns="care_logs">
            <span data-i18n="public.view_all_status" data-i18n-ns="care_logs">å…¨çŒ«ã®è¨˜éŒ²çŠ¶æ³ã‚’è¦‹ã‚‹</span>
        </a>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="/static/js/care_log_list.js"></script>
{% endblock %}
